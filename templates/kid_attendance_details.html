{% extends "base.html" %}

{% block title %}TNT Reading Teams Tracker - {{ kid_name }}{% endblock %}

{% block content %}
<a href="/attendance/{{ day_index }}/team/{{ team_name }}" class="back-button">
    ← Back to {{ team_name }} Team
</a>

<div class="page-header">
    <div class="team-badge {{ team_name|lower }}">{{ team_name }} Team</div>
    <h1>{{ kid_name }}</h1>
    <p class="subtitle">{{ day_data.Date }} - {{ day_data.Theme }}</p>
</div>

{% if kid_entry %}
<form id="editForm" method="POST" action="/edit_attendance">
    <input type="hidden" name="day_index" value="{{ day_index }}">
    <input type="hidden" name="team_name" value="{{ team_name }}">
    <input type="hidden" name="kid_name" value="{{ kid_name }}">
    
    <div class="attendance-details" id="attendanceDetails">
        <div class="details-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Details</h3>
                <button type="button" class="edit-button" onclick="toggleEditMode()">Edit</button>
            </div>
        </div>
        <div class="details-list">
            {% for key, value in kid_entry.items() %}
            {% if key not in ['Name', 'Team', 'timestamp', 'Timestamp'] %}
            <div class="detail-row">
                <span class="detail-label">{{ key }}:</span>
                <div class="detail-status">
                    <div class="status-display">
                        {% if key == 'Date' %}
                        <span class="status-text">{{ value }}</span>
                        {% elif value and value|string|lower in ['true', 'yes', '1', 'present'] %}
                        <span class="status-icon check">✓</span>
                        {% else %}
                        <span class="status-icon x">✗</span>
                        {% endif %}
                    </div>
                    {% if key != 'Date' %}
                    <label class="toggle-switch">
                        <input type="checkbox" name="{{ key }}" {% if value and value|string|lower in ['true', 'yes', '1', 'present'] %}checked{% endif %}>
                        <span class="slider"></span>
                    </label>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        <div class="edit-buttons">
            <button type="submit" class="save-button">Save</button>
            <button type="button" class="cancel-button" onclick="toggleEditMode()">Cancel</button>
        </div>
    </div>
</form>
{% else %}
<div class="no-data">
    <h2>No Data Found</h2>
    <p>No attendance data found for {{ kid_name }} on {{ day_data.Date }}.</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function toggleEditMode() {
    const details = document.getElementById('attendanceDetails');
    details.classList.toggle('edit-mode');
}

document.getElementById('editForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(this);
    fetch('/edit_attendance', {
        method: 'POST',
        body: formData
    }).then(response => {
        if (response.ok) {
            window.location.reload();
        } else {
            alert('Error updating attendance');
        }
    }).catch(error => {
        console.error('Error:', error);
        alert('Error updating attendance');
    });
});
</script>
{% endblock %}