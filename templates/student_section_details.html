{% set show_header = true %}
{% set page_title = "Section " + section_entry.Section|string %}
{% set back_url = "/progress/student/" + student_name|urlencode %}
{% extends "base.html" %}

{% block title %}TNT Reading Teams Tracker - {{ student_name }} - Section {{ section_entry.Section }}{% endblock %}

{% block content %}
<a href="/progress/student/{{ student_name|urlencode }}" class="back-button">
    ← Back to {{ student_name }}
</a>

<div class="page-header">
    <div class="team-badge {{ section_entry.Team|lower }}">{{ section_entry.Team }} Team</div>
    <h1>{{ student_name }}</h1>
    <p class="subtitle">Section {{ section_entry.Section }} - {{ section_entry.Date }}</p>
</div>

{% if section_entry %}
<form id="editForm" method="POST" action="/edit_progress_section">
    <input type="hidden" name="student_name" value="{{ student_name }}">
    <input type="hidden" name="section_index" value="{{ section_index }}">
    
    <div class="attendance-details" id="attendanceDetails">
        <div class="details-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Section Completion Details</h3>
                <button type="button" class="edit-button" onclick="toggleEditMode()">Edit</button>
            </div>
        </div>
        <div class="details-list">
            {% for key, value in section_entry.items() %}
            {% if key not in ['Name', 'Team', 'Date', 'Section', 'timestamp', 'Timestamp'] %}
            <div class="detail-row">
                <span class="detail-label">{{ key }}:</span>
                <div class="detail-status">
                    <div class="status-display">
                        {% if value and value|string|lower in ['true', 'yes', '1'] %}
                        <span class="status-icon check">✓</span>
                        {% else %}
                        <span class="status-icon x">✗</span>
                        {% endif %}
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="{{ key }}" {% if value and value|string|lower in ['true', 'yes', '1'] %}checked{% endif %}>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        <div class="edit-buttons">
            <button type="submit" class="save-button">Save</button>
            <button type="button" class="cancel-button" onclick="toggleEditMode()">Cancel</button>
        </div>
    </div>
</form>
{% else %}
<div class="no-data">
    <h2>No Data Found</h2>
    <p>No section data found.</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function toggleEditMode() {
    const details = document.getElementById('attendanceDetails');
    details.classList.toggle('edit-mode');
}

document.getElementById('editForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(this);
    fetch('/edit_progress_section', {
        method: 'POST',
        body: formData
    }).then(response => {
        if (response.ok) {
            window.location.reload();
        } else {
            alert('Error updating section completion');
        }
    }).catch(error => {
        console.error('Error:', error);
        alert('Error updating section completion');
    });
});
</script>
{% endblock %}